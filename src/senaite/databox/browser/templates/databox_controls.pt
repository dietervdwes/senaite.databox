<div i18n:domain="senaite.databox">

  <form name="databox-form"
        class="form"
        method="post"
        i18n:domain="senaite.core"
        enctype="multipart/form-data"
        tal:attributes="action string:${here/absolute_url}/@@edit">

    <!-- Custom Edit View -->
    <div class="form-row align-items-center">
      <!-- sort on -->
      <div class="col-auto">
        <div class="input-group mb-2 mr-sm-2">
          <div class="input-group-prepend">
            <div class="input-group-text">
              <span i18n:translate="">Sort on</span>
            </div>
          </div>
          <select class="form-control"
                  name="form.widgets.IDataBoxBehavior.sort_on">
            <tal:indexes repeat="index view/get_catalog_indexes">
              <option tal:attributes="value index; selected python:context.sort_on == index and 'selected' or ''">
                <span tal:replace="index"/>
              </option>
            </tal:indexes>
          </select>
        </div>
      </div>
      <!-- limit -->
      <div class="col-auto">
        <div class="input-group mb-2 mr-sm-2">
          <div class="input-group-prepend">
            <div class="input-group-text">
              <span i18n:translate="">Limit</span>
            </div>
          </div>
          <input type="number"
                 style="width:75px"
                 class="form-control"
                 id="field-limit"
                 tal:attributes="value here/limit"
                 min="1"
                 name="form.widgets.IDataBoxBehavior.limit">
        </div>
      </div>
      <!-- Reversed order -->
      <div class="col-auto">
        <div class="form-check mb-2">
          <input type="checkbox"
                 class="form-check-input"
                 id="field-sort_reversed"
                 tal:attributes="checked here/sort_reversed"
                 value="selected"
                 name="form.widgets.IDataBoxBehavior.sort_reversed:list">
          <label class="form-check-label" for="field-sort_reversed" i18n:translate="">
            Reversed order
          </label>
        </div>
      </div>
    </div>

    <div class="form-row align-items-center"
         tal:repeat="column view/get_columns">
      <!-- Column -->
      <div class="col-auto">
        <div class="input-group mb-2 mr-sm-2">
          <div class="input-group-prepend">
            <div class="input-group-text">
              <span i18n:translate="">Column</span>
            </div>
          </div>
          <select class="form-control"
                  name="form.widgets.IDataBoxBehavior.columns.key.0:list">
            <tal:indexes repeat="field view/get_schema_fields">
              <option tal:define="fieldname field/getName"
                      tal:attributes="value fieldname; selected python:fieldname == column and 'selected' or ''">
                <span tal:replace="fieldname"/>
              </option>
            </tal:indexes>
          </select>
        </div>
      </div>

    </div>


    <!-- hidden fields -->
    <input type="hidden" name="form.widgets.IBasic.title" tal:attributes="value here/title" />
    <input type="hidden" name="form.widgets.IDataBoxBehavior.query_type" tal:attributes="value here/query_type" />

    <!-- <input type="hidden" name="form.widgets.IDataBoxBehavior.columns.key.0:list" value="id" />
         <input type="hidden" name="form.widgets.IDataBoxBehavior.columns.0.key.0" value="title" />
         <input type="hidden" name="form.widgets.IDataBoxBehavior.columns.0.0" value="ID" />
         <input type="hidden" name="form.widgets.IDataBoxBehavior.columns.key.0-empty-marker" value="1" />
    -->
    <!-- !TEMPORARY DEACTIVATED!
         ReactJS managed component -->
    <div tal:condition="python:False"
         class="databox"
         tal:attributes="view/settings">
    </div>
    <!-- /ReactJS managed component -->

    <!-- submit -->
    <input class="btn btn-sm btn-primary" type="submit" name="form.buttons.save" value="Update" />
  </form>

</div>
